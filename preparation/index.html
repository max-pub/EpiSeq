<link rel="stylesheet" href="../style/base.css">
<link rel="stylesheet" href="../style/form.css">
<link rel="stylesheet" href="../style/style.css">
<link rel="stylesheet" href="../style/12.css">


<h1><a href='../'>&larr;</a> Preparation</h1>

<!-- <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/water.css@2/out/water.css"> -->
<!-- <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@2.1.1/css/pico.classless.min.css"> -->
<!-- <link rel="stylesheet" href="../style.css"> -->

<!-- <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/purecss@3.0.0/build/pure-min.css" integrity="sha384-X38yfunGUhNzHpBaEBsWLO+A0HDYOQi8ufWDkZ0k9e0eXz/tH3II7uKZ9msv++Ls" crossorigin="anonymous"> -->


<style>
    td:nth-child(1) {
        width: 150px;
    }

    td:nth-child(2) {
        width: 300px;
    }

    td:nth-child(3) {
        width: 400px;
    }

    h2 {
        font-size: 1.2rem;
    }

    input:not([type="file"]):not([type="checkbox"]) {
        width: 110px;
    }

    .stats th {
        text-align: right;
        font-size: 0.8rem;
    }

    .stats td {
        text-align: right;
        font-size: 0.8rem;
        border: 1px solid silver;
        width: 1px !important;
    }
    .duration{color: silver; border: none !important;}

</style>

<form>

    <!-- <h2>Data Source</h2> -->
    <fieldset>
        <legend>Select Data Source</legend>

        <!-- <input type="file" id="typingFile" accept=".tsv" multiple /> -->
        <table>
            <tr>
                <td>germ name</td>
                <td> <input type="text" name="germName" accept=".tsv" placeholder="unkown germ"/> </td>
                <td class="help"> will be used in export and diagram creation </td>
            </tr>
            <tr>
                <td>typing data</td>
                <td> <input type="file" name="typingFile" accept=".tsv" /> </td>
                <td class="help"> select a typing source file </td>
            </tr>
            <tr>
                <td>location data</td>
                <td> <input type="file" name="locationFile" accept=".tsv" /> </td>
                <td class="help"> select a typing source file </td>
            </tr>
        </table>

    </fieldset>


    <fieldset>
        <legend>Date Filter</legend>
        <!-- <h2>Date Filter</h2> -->

        <table>
            <tr>
                <td> from </td>
                <td> <input type="date" name="from" value="2015-01-01" /> </td>
                <td class="help"> remove all entries <i>before</i> the given date </td>
            </tr>

            <tr>
                <td> till </td>
                <td> <input type="date" name="till" value="2017-01-01" /> </td>
                <td class="help"> remove all entries <i>after</i> the given date </td>
            </tr>

            <tr>
                <td> valid dates </td>
                <td>
                    <label>
                        <input type="checkbox" name="dateRequired" checked>
                        required
                    </label>
                    <!-- <div>
                    <input type="checkbox" id="validdate" value="validdate" checked>
                    <label for="validdate">required</label>
                </div> -->
                </td>
                <td class="help"> remove records without start or end or sample date </td>
            </tr>

        </table>
    </fieldset>


    <fieldset>
        <legend>Typing Filter</legend>
        <!-- <h2>Typing Filter</h2> -->

        <table>
            <!-- <tr class="divider">
            <td colspan="3">
                <hr />
            </td>
        </tr> -->
            <tr>
                <td> rows </td>
                <td> <input type="number" name="rowFilter" value="90" min="0" max="100" size="3" />% </td>
                <td class="help"> min. percentage of correctly decoded alleles in any given row (<a
                        href="https://github.com/max-pub/mro-epi#list-filter" target="_blank">help</a>)</td>
            </tr>

            <tr>
                <td> columns </td>
                <td> <input type="number" name="columnFilter" value="0" min="0" max="100" size="3" />% </td>
                <td class="help"> min. percentage of correctly decoded alleles in any given column (<a
                        href="https://github.com/max-pub/mro-epi#list-filter" target="_blank">help</a>)</td>
            </tr>
        </table>
    </fieldset>

    <fieldset>
        <legend>Location Filter</legend>

        <!-- <h2>Location Filter</h2> -->
        <table>
            <!-- <tr class="divider">
            <td colspan="3">
                <hr />
            </td>
        </tr> -->

            <tr>
                <td> clinic </td>
                <td>
                    <label>
                        <input type="checkbox" name="clinicRequired" checked>
                        required
                    </label>
                </td>
                <td class="help"> remove records without clinic-entry </td>
            </tr>
            <tr>
                <td> ward </td>
                <td>
                    <label>
                        <input type="checkbox" name="wardRequired" checked>
                        required
                    </label>
                </td>
                <td class="help"> remove records without ward-entry </td>
            </tr>
            <tr>
                <td> room </td>
                <td>
                    <label>
                        <input type="checkbox" name="roomRequired" checked>
                        required
                    </label>
                </td>
                <td class="help"> remove records without room-entry </td>
            </tr>
            <!-- <tr id="adjustOpenEnds">
			<td> adjust open ends </td>
			<td> <input type="checkbox" checked> </td>
			<td class="help"> fix entries without end-dates </td>
		</tr> -->

        </table>
    </fieldset>

    <fieldset>
        <legend>Other Settings</legend>


        <!-- <h2>Other Settings</h2> -->

        <table>
            <!-- <tr class="divider">
            <td colspan="3">
                <hr />
            </td>
        </tr> -->
            <!-- <tr id="hasRoom">
			<td> room data required </td>
			<td> <input type="checkbox" checked> </td>
			<td class="help"> keep only patients that have at least one room entry (i.e. exlude out-patients)</td>
		</tr> -->

            <tr>
                <td> IDs </td>
                <td>
                    <label>
                        <input type="checkbox" name="pseudonymize" checked>
                        pseudonymize
                    </label>
                    <!-- <div>
                    <input type="checkbox" id="pseudonymize" value="pseudonymize" checked>
                    <label for="pseudonymize">pseudonymize</label>
                </div> -->
                    <!-- <input type="checkbox" checked>  -->
                </td>
                <td class="help">
                    replace all identifiers like patientID or sampleID with random strings <br />
                    also replacing clinic,ward,location strings
                </td>
            </tr>


            <!-- <tr class="divider">
                <td colspan="3">
                    <hr />
                </td>
            </tr> -->

            <tr>
                <td> count unknown </td>
                <td> <input name="countNull" type="checkbox"> </td>
                <td class="help"> interpret undeciphered alleles as different (<a
                        href="https://github.com/max-pub/mro-epi#matrix-calculation" target="_blank">help</a>)</td>
            </tr>

        </table>
    </fieldset>

    <div class="flex-row">
        <button type="submit">prepare the data according to the settings</button>
        <div id="progress" class="flex-row hidden">
            <progress></progress>
            <span class="percent"></span>
            <span class="text"></span>
        </div>
    </div>
</form>

<div class="flex-around">
    <table id="typing" class="stats">
        <thead>
            <tr>
                <th></th>
                <th>Sequences</th>
                <th>Patients</th>
                <th>Alleles</th>
                <th class="duration">Duration</th>
            </tr>
        </thead>
        <tbody></tbody>
        <caption>typing filter </caption>
    </table>

    <table id="location" class="stats">
        <thead></thead>
        <tr>
            <th></th>
            <th>Locations</th>
            <th>Patients</th>
            <th class="duration">Duration</th>
        </tr>
        </thead>
        <tbody></tbody>
        <caption>location filter </caption>
    </table>
</div>

<output></output>


<br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />

<div id="download" class="hidden">
    <a id="downloadResult" class="button ">download all calculations</a>
    <a id="cacheAndProceed" class="button ">save to cache and proceed with correlation</a>
    <a id="downloadStats" class="button ">download statistics</a>
</div>

<script type="module" src="index.js"></script>

