<!-- <link rel="stylesheet" href="//cdn.jsdelivr.net/chartist.js/latest/chartist.min.css"> -->
<!-- <script src="//cdn.jsdelivr.net/chartist.js/latest/chartist.min.js"></script> -->

<!-- <script src="https://cdn.jsdelivr.net/npm/chartist@1.3.0/dist/index.umd.min.js"></script> -->
<!-- <link href="https://cdn.jsdelivr.net/npm/chartist@1.3.0/dist/index.min.css" rel="stylesheet"> -->

<!-- <div class="ct-chart ct-perfect-fourth"></div> -->

<script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>



<a onclick="document.location.reload(true)">reload</a>
<br />
<br />
<br />

<fieldset>
	<legend>load source data</legend>
	<table id="source">
		<tr id="cgmlst">
			<td> cgMLST </td>
			<!-- <td> <input type="file" onchange="loadFile(event,'cgmlst')" /> </td> -->
			<td> <input type="file" /> </td>
			<td class="help"> accepting TSV-format with the following headers: <i>sequenceID, patientID, typingDate,
					allele1,..., alleleX</i> </td>
		</tr>
		<tr id="locations">
			<td> locations </td>
			<td> <input type="file" /> </td>
			<td class="help"> accepting TSV-format with the following headers: <i>locationID, patientID, clinic, ward,
					room, from, till</i> </td>
		</tr>
	</table>
	<br />
	<!-- <a onclick="loadDemo()">load demo files instead</a> -->
	<a id="loadDemo1">load e.coli demo</a>
	<a id="loadDemo2">load mrsa demo</a>
	<!-- <hr /> -->
	<!-- <div id="loadResult"></div> -->
</fieldset>









<fieldset>
	<legend>filter & options</legend>
	<table id="filter">
		<tr id="from">
			<td> from </td>
			<td> <input type="date" value="2017-01-01" /> </td>
			<td class="help"> remove all entries <i>before</i> the given date </td>
		</tr>

		<tr id="till">
			<td> till </td>
			<td> <input type="date" value="2018-01-01" /> </td>
			<td class="help"> remove all entries <i>after</i> the given date </td>
		</tr>

		<tr id="rows">
			<td> rows </td>
			<td> <input type="number" value="95" min="0" max="100" size="3" />% </td>
			<td class="help"> minimal percentage of correct alleles </td>
		</tr>

		<tr id="cols">
			<td> columns </td>
			<td> <input type="number" value="95" min="0" max="100" size="3" />% </td>
			<td class="help"> minimal percentage of correct alleles </td>
		</tr>

		<tr id="hasRoom">
			<td> room data required </td>
			<td> <input type="checkbox" checked> </td>
			<td class="help"> keep only patients that have at least one room entry </td>
		</tr>
		<tr id="matchingPatients">
			<td> typing & location </td>
			<td></td>
			<td class="help"> keep only patients that have both typing and location records</td>
		</tr>
		<tr id="pseudonymize">
			<td> pseudonymize </td>
			<td> <input type="checkbox"> </td>
			<td class="help"> replace identifiers in input data with random strings </td>
		</tr>

		<!-- <tr>
			<td> counting </td>
			<td> <input type="checkbox"> </td>
			<td class="help"> count unresolved alleles as difference </td>
		</tr> -->
	</table>

	<hr />
	<table id="filterResults">
		<tr id="cgmlst">
			<td> cgMLST </td>
			<td class="help"></td>
			<td> <a hidden>download</a> </td>
		</tr>
		<tr id="locations">
			<td> locations </td>
			<td class="help"></td>
			<td> <a hidden>download</a> </td>
		</tr>
	</table>
	</table>

</fieldset>










<fieldset>
	<legend>calculate distance matrices</legend>
	<table id="distance">
		<!-- <tr>
			<td> counting </td>
			<td> <input type="checkbox"> </td>
			<td class="help"> count unresolved alleles as difference </td>
		</tr> -->
		<tr id="cgmlst">
			<td> cgMLST </td>
			<td> <progress value="0" max="100"> </progress> </td>
			<td class="current"></td>
			<td>/</td>
			<td class="total"></td>
			<td hidden> <a class="matrix">matrix</a> <a class="stat">stats</a> <a class="graph">graph</a> </td>
			<td class="help"></td>
		</tr>
		<tr id="locations">
			<td> locations </td>
			<td> <progress value="0" max="100"> </progress> </td>
			<td class="current"></td>
			<td>/</td>
			<td class="total"></td>
			<td hidden> <a class="matrix">matrix</a> </td>
			<td class="help"></td>
		</tr>
	</table>

	<div id="chart"></div>

</fieldset>

<!-- < fieldset >
		<legend>show cgmlst statistics</legend>
</fieldset > -->








<fieldset>
	<legend>correlation of cgmlst and location data</legend>
	<table id="correlation">
		<tr id="ti">
			<td> TI </td>
			<td class="help1"> [TypingInterval] </td>
			<td> <input type="number" value="180" min="0" max="9999" size="4" /> </td>
			<td class="help"> time period between typings in days (use "0" for "unlimited") /TP </td>
		</tr>
		<tr id="td">
			<td> TD </td>
			<td class="help1"> [TypingDistance] </td>
			<td> <input type="number" value="30" min="0" max="3000" size="4" /> </td>
			<td class="help"> upper limit of allowed cgmlst - distances between two typings</td>
		</tr>

		<tr>
			<td colspan="4">
				<hr />
			</td>
		</tr>
		<tr id="cl">
			<td> CL </td>
			<td class="help1"> [ContactLevel] </td>
			<td>
				<select>
					<option>room</option>
					<option>ward</option>
					<option>clinic</option>
					<option selected="selected">any</option>
				</select>
			</td>
			<td class="help"> adminstrative level of contact-comparisons: room, ward, clinic or any of the
				aforementioned </td>
		</tr>
		<tr id="ci">
			<td> CI </td>
			<td class="help1"> [ContactInterval] </td>
			<td> <input type="number" value="-7" min="-100" max="100" size="4" /> </td>
			<td class="help"> lower limit of accepted time interval between contacts in days<br />negative numbers
				indicate non-overlapping time-distance, positive numbers indicate strict overlap /TI </td>
		</tr>
		<tr id="cd">
			<td> CD </td>
			<td class="help1"> [ContactDepth] </td>
			<td> <input type="number" value="0" min="0" max="5" size="4" /> </td>
			<td class="help"> allowed amount of intermediary contacts between two patients, "0" means direct contact
			</td>
		</tr>
	</table>

	<!-- <hr /> -->

	<table id="correlationResult">
		<!-- <tr>
			<td> counting </td>
			<td> <input type="checkbox"> </td>
			<td class="help"> count unresolved alleles as difference </td>
		</tr> -->
		<tr id="cgmlst">
			<td> cgMLST </td>
			<td> <progress value="0" max="100"> </progress> </td>
			<td class="count"></td>
			<!-- <td>/</td> -->
			<!-- <td class="total"></td> -->
			<td> <a hidden>download</a> </td>
			<td class="help"></td>
		</tr>
		<tr id="locations">
			<td> locations </td>
			<td> <progress value="0" max="100"> </progress> </td>
			<td class="count"></td>
			<!-- <td>/</td> -->
			<!-- <td class="total"></td> -->
			<td> <a hidden>download</a> </td>
			<td class="help"></td>
		</tr>
	</table>

	<hr />
	<a id="correlationDownload">download</a>
	<div id="correlationTables">

	</div>

	<div id="correlationChart">

	</div>
</fieldset>










<style>
	* {
		font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
	}

	.help {
		color: gray;
	}

	fieldset {
		margin-bottom: 3em;
	}

	a {
		cursor: pointer;
		/* color: blue; */
		text-decoration: underline;
	}

	a:hover {
		color: blue;
	}

	#correlationResult {
		display: none;
	}

	table caption {
		color: gray;
		font-size: 11px;
		white-space: pre;
	}

	#correlationTables>div {
		margin-bottom: 0.5rem;
	}

	#correlationTables table {
		border-collapse: collapse;
		/* margin-bottom: 0.5rem; */
		caption-side: bottom;
		width: 100%;
	}

	#correlationTables td,
	#correlationTables th {
		border: 1px solid silver;
		text-align: right;
		font-size: 11px;
		padding: 0.1rem 0.3rem;
	}

	#correlationTables th:first-child {
		text-align: left;
	}

	a.remove {
		display: block;
		margin: auto;
		text-align: center;
		text-decoration: none;
		font-size: 11px;
		color: red;
	}
</style>







<!-- < script type = "module" src = "deps.js" ></script > -->
<script type="module">
	// import * as fs from './lib/fs.js'
	// import { TALI } from './lib/deps.js'
	// import { gridStats, colFilter, rowFilter } from './lib/filter.js'
	// import { roomFilter, patientIntersectionFilter } from './lib/filter.js'
	// import { $, $$, download } from './helper.js'
	// const FS = new Worker("./lib/fs.js");
	// import { start } from './flow.js'

	import './events.js'




</script>