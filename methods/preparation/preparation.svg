<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 650" font-family="Arial, Helvetica, sans-serif">
  
  <!-- Definitions for reusable elements -->
  <defs>
    <!-- Arrow Marker (Corrected alignment and size) 
         viewBox 0 0 10 10. Tip at 10,5. 
         markerWidth=3 with stroke-width=6 => 18px wide arrow.
    -->
    <marker id="arrowhead-purple" viewBox="0 0 10 10" markerWidth="2.5" markerHeight="2.5" refX="9" refY="5" orient="auto">
      <path d="M0,0 L10,5 L0,10 Z" fill="#6a3d9a" />
    </marker>
    <marker id="arrowhead-orange" viewBox="0 0 10 10" markerWidth="2.5" markerHeight="2.5" refX="9" refY="5" orient="auto">
      <path d="M0,0 L10,5 L0,10 Z" fill="#e67e22" />
    </marker>
    <marker id="arrowhead-teal" viewBox="0 0 10 10" markerWidth="2.5" markerHeight="2.5" refX="9" refY="5" orient="auto">
      <path d="M0,0 L10,5 L0,10 Z" fill="#5da5c8" />
    </marker>

    <!-- Gradients -->
    <linearGradient id="grad-purple" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#8e6bb5;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#704b96;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="grad-orange" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#f59e55;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#e67e22;stop-opacity:1" />
    </linearGradient>

    <!-- Symbol: 6x6 Table (Large) -->
    <symbol id="table-large-purple" viewBox="0 0 120 120">
      <rect x="0" y="0" width="120" height="120" rx="5" fill="#dcd0e8" stroke="#333" stroke-width="2"/>
      <rect x="0" y="0" width="120" height="20" rx="5" fill="url(#grad-purple)" stroke="#333" stroke-width="1"/>
      <path d="M0,20 h120 M0,40 h120 M0,60 h120 M0,80 h120 M0,100 h120" stroke="#333" stroke-width="1"/>
      <path d="M20,0 v120 M40,0 v120 M60,0 v120 M80,0 v120 M100,0 v120" stroke="#333" stroke-width="1"/>
    </symbol>

    <symbol id="table-large-orange" viewBox="0 0 120 120">
      <rect x="0" y="0" width="120" height="120" rx="5" fill="#fce5cd" stroke="#333" stroke-width="2"/>
      <rect x="0" y="0" width="120" height="20" rx="5" fill="url(#grad-orange)" stroke="#333" stroke-width="1"/>
      <path d="M0,20 h120 M0,40 h120 M0,60 h120 M0,80 h120 M0,100 h120" stroke="#333" stroke-width="1"/>
      <path d="M20,0 v120 M40,0 v120 M60,0 v120 M80,0 v120 M100,0 v120" stroke="#333" stroke-width="1"/>
    </symbol>

    <!-- Symbol: 4x4 Table (Small) -->
    <symbol id="table-small-purple" viewBox="0 0 60 60">
      <rect x="0" y="0" width="60" height="60" rx="3" fill="#dcd0e8" stroke="#333" stroke-width="1.5"/>
      <rect x="0" y="0" width="60" height="15" rx="3" fill="url(#grad-purple)" stroke="#333" stroke-width="1"/>
      <path d="M0,15 h60 M0,30 h60 M0,45 h60" stroke="#333" stroke-width="1"/>
      <path d="M15,0 v60 M30,0 v60 M45,0 v60" stroke="#333" stroke-width="1"/>
    </symbol>

    <symbol id="table-small-orange" viewBox="0 0 60 60">
      <rect x="0" y="0" width="60" height="60" rx="3" fill="#fce5cd" stroke="#333" stroke-width="1.5"/>
      <rect x="0" y="0" width="60" height="15" rx="3" fill="url(#grad-orange)" stroke="#333" stroke-width="1"/>
      <path d="M0,15 h60 M0,30 h60 M0,45 h60" stroke="#333" stroke-width="1"/>
      <path d="M15,0 v60 M30,0 v60 M45,0 v60" stroke="#333" stroke-width="1"/>
    </symbol>

    <!-- Symbol: Heatmap Matrix (Triangular) -->
    <symbol id="heatmap-tri" viewBox="0 0 60 60">
      <g stroke="#333" stroke-width="0.5">
        <rect x="0" y="0" width="15" height="15" fill="#f1c40f"/> 
        <rect x="0" y="15" width="15" height="15" fill="#e67e22"/> 
        <rect x="15" y="15" width="15" height="15" fill="#f39c12"/> 
        <rect x="0" y="30" width="15" height="15" fill="#3498db"/> 
        <rect x="15" y="30" width="15" height="15" fill="#9b59b6"/> 
        <rect x="30" y="30" width="15" height="15" fill="#e74c3c"/> 
        <rect x="0" y="45" width="15" height="15" fill="#2ecc71"/> 
        <rect x="15" y="45" width="15" height="15" fill="#3498db"/> 
        <rect x="30" y="45" width="15" height="15" fill="#f1c40f"/> 
        <rect x="45" y="45" width="15" height="15" fill="#e67e22"/>
      </g>
      <rect x="0" y="0" width="60" height="60" rx="3" fill="none" stroke="#000" stroke-width="1.5"/>
      <path d="M15,0 v15 M30,15 v15 M45,30 v15" stroke="#ccc" stroke-width="0.5"/>
      <path d="M15,15 h45 M30,30 h30 M45,45 h15" stroke="#ccc" stroke-width="0.5"/>
    </symbol>
    
    <!-- Icons -->
    <symbol id="icon-funnel" viewBox="0 0 40 40">
      <path d="M5,5 L35,5 L23,20 L23,35 L17,35 L17,20 Z" fill="#78909c" stroke="#333" stroke-width="1.5"/>
      <ellipse cx="20" cy="5" rx="15" ry="3" fill="#cfd8dc" stroke="#333" stroke-width="1.5"/>
    </symbol>

    <symbol id="icon-mask" viewBox="0 0 50 30">
        <path d="M3,10 Q12,0 25,10 Q38,0 47,10 Q47,20 38,25 Q30,30 25,20 Q20,30 12,25 Q3,20 3,10 Z" fill="#aed6f1" stroke="#333" stroke-width="2"/>
        <path d="M10,12 Q15,8 20,12" fill="none" stroke="#333" stroke-width="2"/>
        <path d="M30,12 Q35,8 40,12" fill="none" stroke="#333" stroke-width="2"/>
    </symbol>
    
    <symbol id="icon-lock" viewBox="0 0 30 40">
        <rect x="5" y="15" width="20" height="18" rx="2" fill="#f39c12" stroke="#333" stroke-width="2"/>
        <path d="M9,15 V8 A6,6 0 0,1 21,8 V15" fill="none" stroke="#333" stroke-width="2"/>
        <circle cx="15" cy="24" r="2" fill="#333"/>
        <line x1="15" y1="24" x2="15" y2="29" stroke="#333" stroke-width="2"/>
    </symbol>

    <symbol id="icon-dna" viewBox="0 0 50 50">
      <g transform="rotate(-45, 25, 25)">
        <path d="M15,5 Q25,15 15,25 Q5,35 15,45" fill="none" stroke="#333" stroke-width="3" stroke-linecap="round"/>
        <path d="M35,5 Q25,15 35,25 Q45,35 35,45" fill="none" stroke="#333" stroke-width="3" stroke-linecap="round"/>
        <line x1="18" y1="10" x2="32" y2="10" stroke="#3498db" stroke-width="2"/>
        <line x1="20" y1="18" x2="30" y2="18" stroke="#3498db" stroke-width="2"/>
        <line x1="20" y1="32" x2="30" y2="32" stroke="#3498db" stroke-width="2"/>
        <line x1="18" y1="40" x2="32" y2="40" stroke="#3498db" stroke-width="2"/>
      </g>
    </symbol>

    <symbol id="icon-calendar" viewBox="0 0 50 50">
        <rect x="5" y="8" width="40" height="35" rx="4" fill="#fff" stroke="#333" stroke-width="2"/>
        <path d="M5,18 h40" stroke="#333" stroke-width="2"/>
        <rect x="5" y="8" width="40" height="10" rx="4" fill="#3498db" stroke="none"/>
        <path d="M5,18 h40" stroke="#333" stroke-width="2"/>
        <rect x="5" y="8" width="40" height="35" rx="4" fill="none" stroke="#333" stroke-width="2"/>
        <rect x="10" y="23" width="5" height="5" fill="#333"/>
        <rect x="18" y="23" width="5" height="5" fill="#333"/>
        <rect x="26" y="23" width="5" height="5" fill="#333"/>
        <rect x="34" y="23" width="5" height="5" fill="#333"/>
        <rect x="10" y="32" width="5" height="5" fill="#333"/>
        <rect x="18" y="32" width="5" height="5" fill="#333"/>
        <rect x="26" y="32" width="5" height="5" fill="#333"/>
    </symbol>
    
    <symbol id="icon-check" viewBox="0 0 30 30">
         <circle cx="15" cy="15" r="12" fill="#5da5c8" stroke="#333" stroke-width="2"/>
         <path d="M9,15 l4,4 l8,-8" fill="none" stroke="#333" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/>
    </symbol>

  </defs>

  <!-- Title -->
  <text x="600" y="40" text-anchor="middle" font-size="32" font-weight="bold" fill="#000">Data Preparation Processing Pipeline</text>

  <!-- COLUMN 1: INPUTS -->
  <g transform="translate(50, 100)">
    <use href="#table-large-purple" width="120" height="120"/>
    <text x="60" y="140" text-anchor="middle" font-size="12" font-weight="bold">GENOMIC-TYPING-DATA</text>
    <text x="60" y="155" text-anchor="middle" font-size="12" font-weight="bold">(TABLE 1)</text>
  </g>

  <g transform="translate(50, 350)">
    <use href="#table-large-orange" width="120" height="120"/>
    <text x="60" y="140" text-anchor="middle" font-size="12" font-weight="bold">PATIENT-LOCATION-DATA</text>
    <text x="60" y="155" text-anchor="middle" font-size="12" font-weight="bold">(TABLE 2)</text>
  </g>

  <!-- COLUMN 2: FILTERING -->
  <g transform="translate(240, 170)">
    <rect x="0" y="0" width="120" height="260" rx="10" fill="#fff" stroke="#000" stroke-width="2"/>
    <use href="#icon-funnel" x="35" y="105" width="50" height="50"/>
    <text x="60" y="195" text-anchor="middle" font-size="12" font-weight="bold">USER-ADJUSTABLE</text>
    <text x="60" y="210" text-anchor="middle" font-size="12" font-weight="bold">FILTERING STEP</text>
  </g>

  <!-- Arrows Input -> Filter 
       Paths now end exactly at x=240 with a horizontal segment (H240) to ensure straight arrows.
  -->
  <!-- Purple: Start 170,160 -> End 240,260 (upper part of filter) -->
  <path d="M170,160 H200 Q215,160 215,175 V245 Q215,260 225,260 H240" fill="none" stroke="#6a3d9a" stroke-width="6" marker-end="url(#arrowhead-purple)"/>
  <!-- Orange: Start 170,410 -> End 240,340 (lower part of filter) -->
  <path d="M170,410 H200 Q215,410 215,395 V355 Q215,340 225,340 H240" fill="none" stroke="#e67e22" stroke-width="6" marker-end="url(#arrowhead-orange)"/>

  <!-- COLUMN 3: REDUCED DATA -->
  <g transform="translate(410, 175)">
    <use href="#table-small-purple" width="60" height="60"/>
    <text x="30" y="75" text-anchor="middle" font-size="10" font-weight="bold">REDUCED</text>
    <text x="30" y="87" text-anchor="middle" font-size="10" font-weight="bold">TYPING-DATA</text>
  </g>

  <g transform="translate(410, 335)">
    <use href="#table-small-orange" width="60" height="60"/>
    <text x="30" y="75" text-anchor="middle" font-size="10" font-weight="bold">REDUCED</text>
    <text x="30" y="87" text-anchor="middle" font-size="10" font-weight="bold">LOCATION-DATA</text>
  </g>

  <!-- Arrows Filter -> Reduced 
       Start x=360, End x=410. Added H410 at the end.
  -->
  <!-- Purple: Start 360,260 -> End 410,205 -->
  <path d="M360,260 C380,260 380,205 400,205 H410" fill="none" stroke="#6a3d9a" stroke-width="6" marker-end="url(#arrowhead-purple)"/>
  <!-- Orange: Start 360,340 -> End 410,365 -->
  <path d="M360,340 C380,340 380,365 400,365 H410" fill="none" stroke="#e67e22" stroke-width="6" marker-end="url(#arrowhead-orange)"/>

  <!-- COLUMN 4: PSEUDONYMISATION -->
  <g transform="translate(540, 220)">
    <rect x="0" y="0" width="110" height="150" rx="10" fill="#fff" stroke="#000" stroke-width="2"/>
    <use href="#icon-mask" x="20" y="40" width="70" height="42"/>
    <use href="#icon-lock" x="65" y="75" width="30" height="40"/>
    <text x="55" y="130" text-anchor="middle" font-size="10" font-weight="bold">PSEUDONYMISATION</text>
  </g>

  <!-- Arrows Reduced -> Pseudo 
       Start x=470, End x=540. Added H540.
  -->
  <!-- Purple: Start 470,205 -> End 540,260 -->
  <path d="M470,205 C500,205 500,260 530,260 H540" fill="none" stroke="#6a3d9a" stroke-width="6" marker-end="url(#arrowhead-purple)"/>
  <!-- Orange: Start 470,365 -> End 540,330 -->
  <path d="M470,365 C500,365 500,330 530,330 H540" fill="none" stroke="#e67e22" stroke-width="6" marker-end="url(#arrowhead-orange)"/>

  <!-- COLUMN 5: CALCULATIONS -->
  <g transform="translate(730, 110)">
    <rect x="0" y="0" width="100" height="100" rx="10" fill="#fff" stroke="#000" stroke-width="2"/>
    <use href="#icon-dna" x="25" y="20" width="50" height="50"/>
    <text x="50" y="120" text-anchor="middle" font-size="10" font-weight="bold">DISTANCE-MATRICES</text>
    <text x="50" y="132" text-anchor="middle" font-size="10" font-weight="bold">CALCULATION</text>
    <text x="50" y="144" text-anchor="middle" font-size="10" font-weight="bold">(TYPING)</text>
  </g>

  <g transform="translate(730, 360)">
    <rect x="0" y="0" width="100" height="100" rx="10" fill="#fff" stroke="#000" stroke-width="2"/>
    <use href="#icon-calendar" x="20" y="20" width="50" height="50"/>
    <use href="#icon-check" x="55" y="55" width="35" height="35"/>
    <text x="50" y="120" text-anchor="middle" font-size="10" font-weight="bold">DISTANCE-MATRICES</text>
    <text x="50" y="132" text-anchor="middle" font-size="10" font-weight="bold">CALCULATION</text>
    <text x="50" y="144" text-anchor="middle" font-size="10" font-weight="bold">(LOCATION)</text>
  </g>

  <!-- Arrows Pseudo -> Calcs 
       Start x=650, End x=730. Added H730.
  -->
  <!-- Blue Up: Start 650,260 -> End 730,160 -->
  <path d="M650,260 H670 Q690,260 690,245 V175 Q690,160 710,160 H730" fill="none" stroke="#5da5c8" stroke-width="6" marker-end="url(#arrowhead-teal)"/>
  <!-- Blue Down: Start 650,330 -> End 730,410 -->
  <path d="M650,330 H670 Q690,330 690,345 V395 Q690,410 710,410 H730" fill="none" stroke="#5da5c8" stroke-width="6" marker-end="url(#arrowhead-teal)"/>

  <!-- COLUMN 6: OUTPUT MATRICES -->
  <g transform="translate(950, 70)">
    <use href="#heatmap-tri" width="60" height="60"/>
    <text x="30" y="75" text-anchor="middle" font-size="10" font-weight="bold">Typing Distance</text>
    <text x="30" y="87" text-anchor="middle" font-size="10" font-weight="bold">Matrix</text>
  </g>

  <g transform="translate(950, 180)">
    <use href="#heatmap-tri" width="60" height="60"/>
    <text x="30" y="75" text-anchor="middle" font-size="10" font-weight="bold">SampleDate Distance</text>
    <text x="30" y="87" text-anchor="middle" font-size="10" font-weight="bold">Matrix</text>
  </g>

  <g transform="translate(950, 290)">
    <use href="#heatmap-tri" width="60" height="60"/>
    <text x="30" y="75" text-anchor="middle" font-size="10" font-weight="bold">Clinic-Contact</text>
    <text x="30" y="87" text-anchor="middle" font-size="10" font-weight="bold">Distance Matrix</text>
  </g>

  <g transform="translate(950, 380)">
    <use href="#heatmap-tri" width="60" height="60"/>
    <text x="30" y="75" text-anchor="middle" font-size="10" font-weight="bold">Ward-Contact</text>
    <text x="30" y="87" text-anchor="middle" font-size="10" font-weight="bold">Distance Matrix</text>
  </g>

  <g transform="translate(950, 470)">
    <use href="#heatmap-tri" width="60" height="60"/>
    <text x="30" y="75" text-anchor="middle" font-size="10" font-weight="bold">Room-Contact</text>
    <text x="30" y="87" text-anchor="middle" font-size="10" font-weight="bold">Distance Matrix</text>
  </g>

  <!-- Arrows Calcs -> Outputs 
       Start x=830, End x=950. Added H950.
  -->
  
  <!-- From Typing Calc (830, 160) -->
  <!-- To Top (950, 100) -->
  <path d="M830,160 H860 Q890,160 890,145 V115 Q890,100 920,100 H950" fill="none" stroke="#5da5c8" stroke-width="6" marker-end="url(#arrowhead-teal)"/>
  <!-- To Bot (950, 210) -->
  <path d="M830,160 H860 Q890,160 890,175 V195 Q890,210 920,210 H950" fill="none" stroke="#5da5c8" stroke-width="6" marker-end="url(#arrowhead-teal)"/>

  <!-- From Location Calc (830, 410) -->
  <!-- To Top (950, 320) -->
  <path d="M830,410 H860 Q890,410 890,395 V335 Q890,320 920,320 H950" fill="none" stroke="#5da5c8" stroke-width="6" marker-end="url(#arrowhead-teal)"/>
  <!-- To Mid (950, 410) -->
  <path d="M830,410 H950" fill="none" stroke="#5da5c8" stroke-width="6" marker-end="url(#arrowhead-teal)"/>
  <!-- To Bot (950, 500) -->
  <path d="M830,410 H860 Q890,410 890,425 V485 Q890,500 920,500 H950" fill="none" stroke="#5da5c8" stroke-width="6" marker-end="url(#arrowhead-teal)"/>

</svg>