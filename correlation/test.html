<!DOCTYPE html>
<html lang="en">

    <pre hidden>
weights	A	B	C	D	E	F	G	H	I	J
A		2	1	4						
B	2		2	3	3	2				
C	1	2			2	2	3			5
D	4	3					3			
E		3	2				1			4
F		2	2				3	4		
G			3	3	1	3		2		
H					4			1		
I						2	1		2
J			5		4				2	


contacts	A	B	C	D	E	F	G	H	I	J
A		1	1	1						
B	1		1	1	1	1				
C	1	1			1	1	1			1
D	1	1					1			
E		1	1			1			1
F		1	1			1	1		
G			1	1	1			1	
H					1			1	
I							1	1		1
J			1		1			1	
</pre>
<style>
    * {
        font-family: monospace;
    }

    td {
        padding: 5px 10px;
        text-align: center;
    }

    table {
        margin: 30px
    }

    .valid {
        color: green;
    }

    .invalid {
        color: red;
    }
</style>

<body>
    <h1>findContactPath Test Results</h1>
    <div id="results"></div>

    <script type="module">
        import { findContactPath } from './lib/correlation.js';
        import { TaliStream } from '../lib/tali.stream.js';
        import { DistanceMatrix } from '../lib/DistanceMatrix.js';
        import { $ } from '../lib/base.js';
        import { extractContactsPerPatient } from './lib/contact.js';




        async function loadTabline() {
            let output = {}
            let source = $('pre').innerText
            // console.log('loading tabline data',data)
            for await (let [table, rowKey, data, done, total] of TaliStream.fromString(source).tabLine()) {
                if (!output[table]) {
                    output[table] = new DistanceMatrix()
                }
                output[table].setRow(rowKey, data)
            }
            return output
        }

        let data = await loadTabline()
        console.log('loaded data', data)
        let contacts = extractContactsPerPatient(data.contacts)
        console.log('extracted contacts', contacts)

        $('output').innerHTML += data.weights.html()
        $('output').innerHTML += data.contacts.html()


        function testPath(VALID, sourcePID, targetPID, maxDepth, weightBounds, fast = true) {
            let p = findContactPath(sourcePID, targetPID, contacts, data.weights, maxDepth, weightBounds, fast)
            let json = JSON.stringify(p)
            let pathString = p.map(x => x.join('-')).join('  ||  ')
            let isValid = VALID == pathString
            $('output').innerHTML += `<li class="${isValid ? 'valid' : 'invalid'}">Path from ${sourcePID} to ${targetPID}: ${pathString}</li>`
        }
        testPath("A-2-B", 'A', 'B', 4, [0, 100], false)
        testPath("A-4-D", 'A', 'D', 4, [0, 100], false)
        testPath("B-2-F", 'B', 'F', 4, [0, 100], false)
        testPath("B-2-F-4-H", 'B', 'H', 4, [0, 100], false)
        testPath("A-1-C-2-E-4-J", 'A', 'J', 4, [0, 100], false)
        testPath("G-2-I-2-J", 'G', 'J', 4, [0, 100], false)
        testPath("A-1-C-3-G", 'A', 'G', 4, [0, 100], false)
        testPath("B-3-E-1-G", 'B', 'G', 4, [0, 100], false)
        testPath("F-3-G", 'F', 'G', 4, [0, 100], false)
        testPath("D-3-G-2-I-2-J", 'D', 'J', 4, [0, 100], false)

    </script>





    <output></output>
</body>

</html>